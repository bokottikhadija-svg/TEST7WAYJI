<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Khoud-7wayji | No cash? No drama.</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,600;1,300;1,600&family=Inter:wght@300;400;500;600;700;800&display=swap');

    :root { --kh-bg: #fdfdfb; --kh-accent: #0d0d0d; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--kh-bg);
      color: var(--kh-accent);
      margin: 0;
      scroll-behavior: smooth;
    }
    h1, h2, h3, .serif { font-family: 'Cormorant Garamond', serif; }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, .98);
      z-index: 10000;
      backdrop-filter: blur(10px);
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-content {
      background: #fff;
      width: 100%;
      max-width: 500px;
      padding: 40px;
      position: relative;
      border: 1px solid #eee;
      box-shadow: 0 20px 40px rgba(0,0,0,0.05);
    }
    .input-classic {
      width: 100%;
      padding: 14px;
      border: 1px solid #e2e2e0;
      font-size: 14px;
      outline: none;
      margin-bottom: 15px;
    }
    .btn-black {
      background: #000;
      color: #fff;
      width: 100%;
      padding: 16px;
      text-transform: uppercase;
      letter-spacing: .2em;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      border: none;
    }

    .market-locker {
      height: 70vh;
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }
    .market-locker img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 1.5s cubic-bezier(.16, 1, .3, 1);
    }
    .market-locker:hover img { transform: scale(1.08); }

    .locker-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 60%);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 2.5rem;
    }

    #loader {
      position: fixed;
      inset: 0;
      background: white;
      z-index: 20000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #000;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    #cartIcon {
      cursor: pointer;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 11000;
      background: white;
      border: 1px solid black;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .pill-btn {
      font-size: 9px;
      font-weight: 800;
      letter-spacing: .1em;
      text-transform: uppercase;
      padding: 6px 12px;
      background: #000;
      color: #fff;
      transition: 0.3s;
    }
  </style>
</head>
<body>

  <!-- Ã‰cran de Chargement -->
  <div id="loader">
    <div class="spinner"></div>
    <p class="mt-4 serif italic text-xl">Khoud-7wayji</p>
  </div>

  <!-- NAVIGATION -->
  <nav class="sticky top-0 z-[100] bg-white/80 backdrop-blur-md border-b border-[#f0f0ed]">
    <div class="max-w-[1600px] mx-auto px-6 h-20 md:h-24 flex justify-between items-center">
      <div class="flex items-center space-x-4 cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">

        <!-- âœ… LOGO -->
        <div class="w-10 h-10 border-2 border-black flex items-center justify-center">
          <img src="assets/logo de la marque .jpg" alt="Logo Khoud-7wayji" class="w-8 h-8 object-contain" />
        </div>

        <div class="flex flex-col">
          <span class="serif text-xl font-bold tracking-tighter uppercase">KHOUD-7WAYJI</span>
          <span class="text-[7px] tracking-[0.4em] uppercase opacity-40 font-bold">L-STYLE DYALEK</span>
        </div>
      </div>

      <div class="flex items-center space-x-8">
        <a href="#about" class="hidden md:block text-[10px] uppercase font-bold tracking-widest opacity-40 hover:opacity-100">Ã€ Propos</a>
        <a href="#market-section" class="hidden md:block text-[10px] uppercase font-bold tracking-widest opacity-40 hover:opacity-100">Vestiaire</a>
        <button type="button" onclick="window.openModal('adminLoginModal')" class="text-xs opacity-40 hover:opacity-100 transition p-2 cursor-pointer" title="Espace admin">
          <i class="fa-solid fa-lock"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- PANIER ICON -->
  <div id="cartIcon" style="display:none" onclick="window.openModal('cartModal')">
    <i class="fa-solid fa-shopping-bag"></i>
    <div id="cartBadge" class="absolute -top-1 -right-1 bg-black text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">0</div>
  </div>

  <!-- HERO -->
  <header class="pt-24 pb-16 px-6 text-center">
    <h1 class="text-7xl md:text-[10rem] font-medium leading-[0.85] tracking-tighter mb-4">
      No cash?<br><span class="italic font-light opacity-20">No drama.</span>
    </h1>
    <p class="serif italic text-2xl md:text-3xl opacity-60 tracking-tight mb-8">Khoud l-style, flex l-vibe!</p>
    <div class="flex justify-center mt-8">
      <a href="#market-section" class="text-[10px] uppercase font-black tracking-[0.5em] border-b-2 border-black pb-2 hover:opacity-40 transition">AccÃ©der au shop</a>
    </div>
  </header>

  <!-- CATEGORIES -->
  <section class="max-w-[1400px] mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="market-locker" onclick="window.filterGallery('homme')">
      <img src="https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?q=80&w=1200&auto=format&fit=crop" alt="Homme">
      <div class="locker-overlay text-white">
        <h2 class="serif text-6xl italic mb-2">Hommes</h2>
        <p class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-80">Collection Streetwear & Vintage</p>
      </div>
    </div>
    <div class="market-locker" onclick="window.filterGallery('femme')">
      <img src="https://images.unsplash.com/photo-1581044777550-4cfa60707c03?q=80&w=1200&auto=format&fit=crop" alt="Femme">
      <div class="locker-overlay text-white">
        <h2 class="serif text-6xl italic mb-2">Femmes</h2>
        <p class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-80">SÃ©lection Exclusive & Chic</p>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="max-w-[1100px] mx-auto px-6 py-32 grid grid-cols-1 lg:grid-cols-2 gap-20 items-center">
    <div class="bg-gray-100 p-4">
      <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=1000&auto=format&fit=crop" class="w-full grayscale brightness-90" alt="Boutique Seconde Main">
    </div>
    <div class="space-y-8">
      <h2 class="serif text-6xl italic">Notre Vision</h2>
      <div class="text-gray-600 space-y-4 leading-relaxed text-lg">
        <p><strong>Khoud-7wayji</strong> est une plateforme marocaine dÃ©diÃ©e Ã  la seconde main et Ã  la rÃ©utilisation de vÃªtements.</p>
        <p>Nous permettons Ã  chacun de vendre ou acheter des articles de mode tout en donnant une seconde vie aux piÃ¨ces dÃ©jÃ  aimÃ©es. Notre objectif est de rendre la mode plus accessible, plus responsable et plus durable.</p>
        <p>Chez Khoud-7wayji, nous croyons quâ€™un vÃªtement ne se jette pasâ€¦ il se partage. Rejoignez notre communautÃ© et renouvelez votre style autrement.</p>
        <p class="font-bold text-black italic">ðŸ“© Nâ€™hÃ©sitez pas Ã  nous contacter pour toute question ou collaboration.</p>
      </div>
    </div>
  </section>

  <!-- MARKETPLACE -->
  <main id="market-section" class="max-w-[1400px] mx-auto px-6 py-20 border-t border-gray-100">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12">
      <h3 id="galleryTitle" class="serif text-5xl italic">Le Vestiaire</h3>
      <span id="itemCount" class="text-[10px] uppercase font-bold tracking-widest opacity-30 mb-2">0 PIÃˆCES</span>
    </div>
    <div id="galleryContainer" class="grid grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12"></div>
  </main>

  <!-- ADMIN PANEL -->
  <section id="adminPanel" style="display:none;" class="py-24 bg-neutral-100 border-y border-neutral-200">
    <div class="max-w-[500px] mx-auto px-6">
      <div class="flex justify-between items-center mb-10">
        <h2 class="serif text-4xl italic">Gestion Stock</h2>
        <button onclick="window.logoutAdmin()" class="text-[9px] uppercase font-bold tracking-widest border border-black px-4 py-2">DÃ©connexion</button>
      </div>
      <form id="adminAddForm" class="bg-white p-8 border border-black">
        <input type="file" id="adminImage" accept="image/*" class="w-full text-xs mb-4">
        <input id="adminName" placeholder="Nom de l'article" required class="input-classic">
        <div class="grid grid-cols-2 gap-4">
          <select id="adminCategory" class="input-classic">
            <option value="homme">Homme</option>
            <option value="femme">Femme</option>
          </select>
          <input id="adminSize" placeholder="Taille" required class="input-classic">
        </div>
        <input id="adminPrice" type="number" placeholder="Prix (MAD)" required class="input-classic">
        <button type="submit" id="addBtn" class="btn-black">Ajouter au catalogue</button>
      </form>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-black text-white pt-32 pb-16 px-8">
    <div class="max-w-[1400px] mx-auto">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-white/10 pb-20 gap-10">
        <div>
          <p class="serif italic text-6xl mb-4">Khoud-7wayji</p>
          <p class="text-[10px] uppercase tracking-[0.6em] opacity-40">Khoud l-style, flex l-vibe!</p>
        </div>
        <a href="https://www.instagram.com/khoud_7wayji" target="_blank" class="group flex items-center space-x-4 border border-white/20 p-5 hover:bg-white hover:text-black transition-all">
          <i class="fa-brands fa-instagram text-2xl"></i>
          <span class="text-xs font-bold uppercase tracking-widest">Suivre l'aventure</span>
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-20 py-20">
        <div>
          <h4 class="text-[10px] uppercase font-bold tracking-[0.3em] mb-8 opacity-30">Contact</h4>
          <p class="text-sm opacity-60">WhatsApp: +212 7 73 51 57 53</p>
          <p class="text-sm opacity-60 mt-2">Email: khoud7wayji@gmail.com</p>
        </div>
        <div>
          <h4 class="text-[10px] uppercase font-bold tracking-[0.3em] mb-8 opacity-30">Menu</h4>
          <div class="flex flex-col space-y-3 text-xs uppercase font-bold tracking-widest opacity-60">
            <a href="#" class="hover:opacity-100">Accueil</a>
            <a href="#about" class="hover:opacity-100">Ã€ Propos</a>
            <a href="#market-section" class="hover:opacity-100">Boutique</a>
          </div>
        </div>
        <div class="md:text-right">
          <button onclick="window.openModal('adminLoginModal')" class="text-[10px] uppercase font-bold tracking-widest opacity-20 hover:opacity-100">Espace Admin</button>
          <p class="text-[9px] uppercase tracking-widest opacity-20 mt-12">Â© 2024 KHOUD-7WAYJI Â· MAROC</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- MODALS -->
  <div id="adminLoginModal" class="modal">
    <div class="modal-content text-center">
      <button onclick="window.closeModal('adminLoginModal')" class="absolute top-6 right-6 text-xl cursor-pointer">&times;</button>
      <h2 class="serif text-4xl mb-8 italic">AccÃ¨s Admin</h2>

      <!-- Interface conservÃ©e (email + pass) -->
      <form id="adminLoginForm">
        <input type="email" id="adminEmail" placeholder="Email" required class="input-classic">
        <input type="password" id="adminPass" placeholder="Mot de passe" required class="input-classic">
        <button type="submit" class="btn-black">Se connecter</button>
      </form>

      <p class="mt-4 text-[10px] opacity-40">
        (Astuce: la connexion se fait via Google, seul <b>bokottikhadija@gmail.com</b> devient Admin)
      </p>
    </div>
  </div>

  <div id="cartModal" class="modal">
    <div class="modal-content">
      <button onclick="window.closeModal('cartModal')" class="absolute top-6 right-6 text-xl cursor-pointer">&times;</button>
      <h2 class="serif text-4xl mb-8 italic">Mon Panier</h2>
      <div id="cartItemsList" class="max-h-[50vh] overflow-y-auto"></div>
      <div id="cartEmpty" class="text-center py-10 opacity-30 italic">Votre panier est vide.</div>
      <div id="cartSummary" style="display:none">
        <div class="flex justify-between border-t border-black pt-4 mb-8">
          <span class="font-bold uppercase text-[10px] tracking-widest">Total</span>
          <span id="cartTotal" class="font-bold">0 MAD</span>
        </div>
        <button onclick="window.closeModal('cartModal'); window.openModal('checkoutModal')" class="btn-black">Commander</button>
      </div>
    </div>
  </div>

  <div id="checkoutModal" class="modal">
    <div class="modal-content">
      <button onclick="window.closeModal('checkoutModal')" class="absolute top-6 right-6 text-xl cursor-pointer">&times;</button>
      <h2 class="serif text-4xl mb-6 italic">Livraison</h2>
      <form id="checkoutForm">
        <input id="custName" placeholder="Nom Complet" required class="input-classic">
        <input id="custCity" placeholder="Ville" required class="input-classic">
        <input id="custAddress" placeholder="Adresse Exacte" required class="input-classic">
        <button type="submit" class="btn-black">Finaliser sur WhatsApp</button>
      </form>
    </div>
  </div>

  <!-- ALERT -->
  <div id="alert" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[20000] opacity-0 transition-opacity duration-500 pointer-events-none">
    <div class="bg-black text-white px-8 py-4 text-[10px] font-bold uppercase tracking-widest shadow-2xl">
      <span id="alertMsg"></span>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInAnonymously,
      GoogleAuthProvider,
      signInWithPopup,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      deleteDoc,
      doc,
      onSnapshot,
      query,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // =========================
    // Firebase Config (TON CONFIG âœ…)
    // =========================
    const firebaseConfig = {
      apiKey: "AIzaSyB7D9RKxptuYCPIZ8IQvLpjvMVoJzecoAc",
      authDomain: "khoud-7wayji.firebaseapp.com",
      projectId: "khoud-7wayji",
      storageBucket: "khoud-7wayji.firebasestorage.app",
      messagingSenderId: "29364177851",
      appId: "1:29364177851:web:20c1bd8a5e35cee042d29e",
      measurementId: "G-GWHMHM5109"
    };

    const ADMIN_EMAIL_ALLOWED = "bokottikhadija@gmail.com"; // âœ… seul admin

    // =========================
    // Loader
    // =========================
    const hideLoader = () => {
      const loader = document.getElementById('loader');
      if (!loader) return;
      loader.style.opacity = '0';
      setTimeout(() => (loader.style.display = 'none'), 500);
    };
    window.addEventListener('load', () => setTimeout(hideLoader, 500));

    // =========================
    // UI
    // =========================
    window.notify = (msg) => {
      const el = document.getElementById('alert');
      const msgEl = document.getElementById('alertMsg');
      if (!el || !msgEl) return;
      msgEl.innerText = msg;
      el.style.opacity = '1';
      setTimeout(() => (el.style.opacity = '0'), 3000);
    };

    window.openModal = (id) => {
      const modal = document.getElementById(id);
      if (!modal) return;
      modal.style.display = 'flex';
      if (id === 'cartModal') window.renderCartItems();
    };

    window.closeModal = (id) => {
      const modal = document.getElementById(id);
      if (!modal) return;
      modal.style.display = 'none';
    };

    window.onclick = (e) => {
      if (e.target?.classList?.contains('modal')) window.closeModal(e.target.id);
    };

    // =========================
    // Firebase init
    // =========================
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // =========================
    // State
    // =========================
    let articles = [];
    let cart = [];
    let isAdmin = false;
    let currentFilter = 'all';
    let unsubscribeArticles = null;

    // =========================
    // Articles listener (visible to everyone)
    // =========================
    const startArticlesListener = () => {
      try {
        if (unsubscribeArticles) unsubscribeArticles();

        const col = collection(db, "articles");
        const q = query(col, orderBy("createdAt", "desc"));

        unsubscribeArticles = onSnapshot(q, (snap) => {
          articles = snap.docs.map(d => ({ id: d.id, ...d.data() }));
          renderGallery(currentFilter);
        }, (err) => {
          console.warn("Firestore error:", err);
          window.notify("Erreur de chargement du vestiaire (Firestore).");
          renderGallery(currentFilter);
        });
      } catch (e) {
        console.warn(e);
        renderGallery(currentFilter);
      }
    };

    // =========================
    // Auth: clients = anonymous
    // =========================
    const ensureAnonymous = async () => {
      if (!auth.currentUser) {
        await signInAnonymously(auth);
      }
    };

    onAuthStateChanged(auth, async (user) => {
      hideLoader();
      if (!user) return;

      isAdmin = !!user.email && user.email.toLowerCase() === ADMIN_EMAIL_ALLOWED.toLowerCase();

      document.getElementById('adminPanel').style.display = isAdmin ? 'block' : 'none';
      updateCartBadge();
      renderGallery(currentFilter);

      startArticlesListener();
    });

    ensureAnonymous().catch(() => hideLoader());

    // =========================
    // Gallery + filters
    // =========================
    window.filterGallery = (cat) => {
      currentFilter = cat;
      const title = document.getElementById('galleryTitle');
      if (title) {
        title.innerText = cat === 'homme' ? "Vestiaire Homme" : (cat === 'femme' ? "Vestiaire Femme" : "Le Vestiaire");
      }
      renderGallery(cat);
      document.getElementById('market-section')?.scrollIntoView({ behavior: 'smooth' });
    };

    function renderGallery(filter) {
      const container = document.getElementById('galleryContainer');
      const countEl = document.getElementById('itemCount');
      if (!container || !countEl) return;

      const items = filter === 'all' ? articles : articles.filter(a => a.category === filter);
      countEl.innerText = `${items.length} PIÃˆCES`;

      if (items.length === 0) {
        container.innerHTML = `<div class="col-span-full py-20 text-center italic opacity-30">Nouvel arrivage bientÃ´t...</div>`;
        return;
      }

      container.innerHTML = items.map(item => `
        <div class="group">
          <div class="aspect-[3/4] bg-neutral-100 mb-6 overflow-hidden relative">
            <img src="${item.imageUrl}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
            <div class="absolute bottom-4 left-4 bg-white px-2 py-1 text-[8px] font-bold tracking-widest border border-black">${item.size || ''}</div>
            ${isAdmin ?
              `<button onclick="window.deleteItem('${item.id}')" class="absolute top-4 right-4 bg-red-600 text-white text-[8px] font-bold px-3 py-1">Supprimer</button>` :
              `<button onclick="window.addToCart('${item.id}')" class="absolute top-4 right-4 pill-btn opacity-0 group-hover:opacity-100 transition-opacity">Ajouter</button>`
            }
          </div>
          <div class="flex justify-between items-center">
            <h4 class="serif text-xl font-bold">${item.name || ''}</h4>
            <span class="text-[10px] font-bold opacity-40">${item.price || 0} MAD</span>
          </div>
        </div>
      `).join('');
    }

    // =========================
    // Cart logic
    // =========================
    window.addToCart = (id) => {
      const item = articles.find(a => a.id === id);
      if (!item) return window.notify("Article introuvable");
      if (cart.find(c => c.id === id)) return window.notify("DÃ©jÃ  dans le panier");
      cart.push(item);
      updateCartBadge();
      window.notify("Article ajoutÃ© !");
    };

    function updateCartBadge() {
      const badge = document.getElementById('cartBadge');
      const icon = document.getElementById('cartIcon');
      if (!badge || !icon) return;
      badge.innerText = String(cart.length);
      icon.style.display = cart.length > 0 && !isAdmin ? 'flex' : 'none';
    }

    window.renderCartItems = () => {
      const list = document.getElementById('cartItemsList');
      const summary = document.getElementById('cartSummary');
      const empty = document.getElementById('cartEmpty');
      if (!list || !summary || !empty) return;

      if (cart.length === 0) {
        list.innerHTML = "";
        summary.style.display = "none";
        empty.style.display = "block";
        return;
      }

      empty.style.display = "none";
      summary.style.display = "block";

      list.innerHTML = cart.map(item => `
        <div class="flex items-center space-x-4 mb-4 pb-4 border-b border-gray-100">
          <img src="${item.imageUrl}" class="w-16 h-20 object-cover">
          <div class="flex-1">
            <p class="serif font-bold">${item.name}</p>
            <p class="text-[10px] opacity-40 uppercase font-bold tracking-widest">${item.size} Â· ${item.price} MAD</p>
          </div>
          <button onclick="window.removeFromCart('${item.id}')" class="text-xl">&times;</button>
        </div>
      `).join('');

      const total = cart.reduce((acc, i) => acc + Number(i.price || 0), 0);
      document.getElementById('cartTotal').innerText = `${total} MAD`;
    };

    window.removeFromCart = (id) => {
      cart = cart.filter(c => c.id !== id);
      updateCartBadge();
      window.renderCartItems();
    };

    // =========================
    // Checkout WhatsApp (Ã©vite blocage wa.me)
    // =========================
    document.getElementById('checkoutForm').onsubmit = (e) => {
      e.preventDefault();

      const phone = "212773515753";
      const name = document.getElementById('custName').value.trim();
      const city = document.getElementById('custCity').value.trim();
      const address = document.getElementById('custAddress').value.trim();

      const total = cart.reduce((acc, i) => acc + Number(i.price || 0), 0);

      let message =
`COMMANDE KHOUD-7WAYJI

Client: ${name}
Ville: ${city}
Adresse: ${address}

Articles:
${cart.map(i => `- ${i.name} (${i.size}) : ${i.price} MAD`).join('\n')}

TOTAL: ${total} MAD`;

      const url = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
      window.open(url, "_blank");

      cart = [];
      updateCartBadge();
      window.closeModal('checkoutModal');
      window.notify("Commande envoyÃ©e vers WhatsApp");
    };

    // =========================
    // Admin login (Google popup) - interface conservÃ©e
    // =========================
    document.getElementById('adminLoginForm').onsubmit = async (e) => {
      e.preventDefault();

      const enteredEmail = document.getElementById('adminEmail').value.trim().toLowerCase();
      if (enteredEmail !== ADMIN_EMAIL_ALLOWED.toLowerCase()) {
        window.notify("AccÃ¨s refusÃ© (email admin uniquement).");
        return;
      }

      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        if (!user?.email || user.email.toLowerCase() !== ADMIN_EMAIL_ALLOWED.toLowerCase()) {
          await signOut(auth);
          window.notify("Email Google non autorisÃ©. AccÃ¨s refusÃ©.");
          return;
        }

        isAdmin = true;
        window.closeModal('adminLoginModal');
        document.getElementById('adminPanel').style.display = 'block';
        updateCartBadge();
        renderGallery(currentFilter);
        window.notify("Bonjour Admin");

      } catch (err) {
        console.warn(err);
        window.notify("Connexion Google annulÃ©e/bloquÃ©e.");
      }
    };

    window.logoutAdmin = async () => {
      try { await signOut(auth); } catch {}
      isAdmin = false;
      document.getElementById('adminPanel').style.display = 'none';
      updateCartBadge();
      renderGallery(currentFilter);
      window.notify("DÃ©connectÃ©");
      ensureAnonymous().catch(()=>{});
    };

    // =========================
    // Admin add/delete (Firestore)
    // =========================
    window.deleteItem = async (id) => {
      if (!isAdmin) return window.notify("AccÃ¨s refusÃ©");
      if (!confirm("Supprimer l'article ?")) return;

      try {
        await deleteDoc(doc(db, "articles", id));
        window.notify("Article supprimÃ©");
      } catch (e) {
        console.warn(e);
        window.notify("Erreur suppression");
      }
    };

    document.getElementById('adminAddForm').onsubmit = async (e) => {
      e.preventDefault();
      if (!isAdmin) return window.notify("AccÃ¨s refusÃ©");

      const file = document.getElementById('adminImage').files[0];
      if (!file) return window.notify("Photo requise");

      const btn = document.getElementById('addBtn');
      btn.disabled = true; btn.innerText = "Ajout...";

      const reader = new FileReader();
      reader.readAsDataURL(file);

      reader.onload = async () => {
        try {
          await addDoc(collection(db, "articles"), {
            name: document.getElementById('adminName').value,
            category: document.getElementById('adminCategory').value,
            size: document.getElementById('adminSize').value,
            price: document.getElementById('adminPrice').value,
            imageUrl: reader.result,
            createdAt: serverTimestamp()
          });

          document.getElementById('adminAddForm').reset();
          window.notify("Article ajoutÃ© !");
        } catch (e) {
          console.warn(e);
          window.notify("Erreur ajout (Firestore) â€” vÃ©rifie les Rules.");
        } finally {
          btn.disabled = false; btn.innerText = "Ajouter au catalogue";
        }
      };

      reader.onerror = () => {
        btn.disabled = false; btn.innerText = "Ajouter au catalogue";
        window.notify("Erreur lecture image");
      };
    };
  </script>
</body>
</html>
