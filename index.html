<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Khoud-7wayji | No cash? No drama.</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,600;1,300;1,600&family=Inter:wght@300;400;500;600;700;800&display=swap');

    :root {
      --kh-bg: #fdfdfb;
      --kh-accent: #0d0d0d;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--kh-bg);
      color: var(--kh-accent);
      margin: 0;
      scroll-behavior: smooth;
    }

    h1, h2, h3, .serif { font-family: 'Cormorant Garamond', serif; }

    /* Modals */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, .98);
      z-index: 10000;
      backdrop-filter: blur(10px);
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: #fff;
      width: 100%;
      max-width: 500px;
      padding: 40px;
      position: relative;
      border: 1px solid #eee;
      box-shadow: 0 20px 40px rgba(0,0,0,0.05);
    }

    /* Form Elements */
    .input-classic {
      width: 100%;
      padding: 14px;
      border: 1px solid #e2e2e0;
      font-size: 14px;
      outline: none;
      margin-bottom: 15px;
    }
    .input-classic:focus { border-color: #000; }

    .btn-black {
      background: #000;
      color: #fff;
      width: 100%;
      padding: 16px;
      text-transform: uppercase;
      letter-spacing: .2em;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      border: none;
    }

    /* Cards */
    .market-locker {
      height: 70vh;
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }
    .market-locker img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 1.5s cubic-bezier(.16, 1, .3, 1);
    }
    .market-locker:hover img { transform: scale(1.08); }

    .locker-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 60%);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 2.5rem;
    }

    /* Cart & Controls */
    #cartIcon {
      cursor: pointer;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 11000;
      background: white;
      border: 1px solid black;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #cartBadge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: black;
      color: white;
      width: 20px;
      height: 20px;
      font-size: 10px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #loader {
      position: fixed;
      inset: 0;
      background: white;
      z-index: 20000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #000;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .pill-btn {
      font-size: 9px;
      font-weight: 800;
      letter-spacing: .1em;
      text-transform: uppercase;
      padding: 6px 12px;
      background: #000;
      color: #fff;
      transition: 0.3s;
    }
  </style>
</head>
<body>

  <!-- √âcran de chargement -->
  <div id="loader">
    <div class="spinner"></div>
    <p class="mt-4 serif italic text-xl">Khoud-7wayji</p>
  </div>

  <!-- NAVIGATION -->
  <nav class="sticky top-0 z-[100] bg-white/80 backdrop-blur-md border-b border-[#f0f0ed]">
    <div class="max-w-[1600px] mx-auto px-6 h-20 md:h-24 flex justify-between items-center">
      <div class="flex items-center space-x-4 cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
        <div class="w-10 h-10 border-2 border-black flex items-center justify-center font-black text-xs">KH</div>
        <div class="flex flex-col">
          <span class="serif text-xl font-bold tracking-tighter uppercase">KHOUD-7WAYJI</span>
          <span class="text-[7px] tracking-[0.4em] uppercase opacity-40 font-bold">L-STYLE DYALEK</span>
        </div>
      </div>
      <div class="flex items-center space-x-8">
        <a href="#about" class="hidden md:block text-[10px] uppercase font-bold tracking-widest opacity-40 hover:opacity-100">√Ä Propos</a>
        <a href="#market-section" class="hidden md:block text-[10px] uppercase font-bold tracking-widest opacity-40 hover:opacity-100">Vestiaire</a>
        <button onclick="openModal('adminLoginModal')" class="text-xs opacity-40 hover:opacity-100 transition">
            <i class="fa-solid fa-lock"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- ICON PANIER -->
  <div id="cartIcon" style="display:none" onclick="openModal('cartModal')">
    <i class="fa-solid fa-shopping-bag"></i>
    <div id="cartBadge">0</div>
  </div>

  <!-- HERO -->
  <header class="pt-24 pb-16 px-6 text-center">
    <h1 class="text-7xl md:text-[10rem] font-medium leading-[0.85] tracking-tighter mb-4">
      No cash?<br><span class="italic font-light opacity-20">No drama.</span>
    </h1>
    <p class="serif italic text-2xl md:text-3xl opacity-60 tracking-tight mb-8">Khoud l-style, flex l-vibe!</p>
    <div class="flex justify-center mt-8">
        <a href="#market-section" class="text-[10px] uppercase font-black tracking-[0.5em] border-b-2 border-black pb-2 hover:opacity-40 transition">Acc√©der au shop</a>
    </div>
  </header>

  <!-- CAT√âGORIES -->
  <section class="max-w-[1400px] mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="market-locker" onclick="filterGallery('homme')">
      <img src="https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?q=80&w=1200&auto=format&fit=crop" alt="Homme">
      <div class="locker-overlay text-white">
        <h2 class="serif text-6xl italic mb-2">Hommes</h2>
        <p class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-80">Collection Streetwear & Vintage</p>
      </div>
    </div>
    <div class="market-locker" onclick="filterGallery('femme')">
      <img src="https://images.unsplash.com/photo-1581044777550-4cfa60707c03?q=80&w=1200&auto=format&fit=crop" alt="Femme">
      <div class="locker-overlay text-white">
        <h2 class="serif text-6xl italic mb-2">Femmes</h2>
        <p class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-80">S√©lection Exclusive & Chic</p>
      </div>
    </div>
  </section>

  <!-- √Ä PROPOS -->
  <section id="about" class="max-w-[1100px] mx-auto px-6 py-32 grid grid-cols-1 lg:grid-cols-2 gap-20 items-center">
    <div class="bg-gray-100 p-4">
        <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=1000&auto=format&fit=crop" class="w-full grayscale brightness-90">
    </div>
    <div class="space-y-8">
      <h2 class="serif text-6xl italic">Notre Vision</h2>
      <div class="text-gray-600 space-y-4 leading-relaxed text-lg">
        <p><strong>Khoud-7wayji</strong> est une plateforme marocaine d√©di√©e √† la seconde main et √† la r√©utilisation de v√™tements.</p>
        <p>Nous permettons √† chacun de vendre ou acheter des articles de mode tout en donnant une seconde vie aux pi√®ces d√©j√† aim√©es.</p>
        <p class="font-bold text-black italic">üì© N‚Äôh√©sitez pas √† nous contacter sur Instagram @khoud_7wayji.</p>
      </div>
    </div>
  </section>

  <!-- BOUTIQUE -->
  <main id="market-section" class="max-w-[1400px] mx-auto px-6 py-20 border-t border-gray-100">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12">
      <h3 id="galleryTitle" class="serif text-5xl italic">Le Vestiaire</h3>
      <span id="itemCount" class="text-[10px] uppercase font-bold tracking-widest opacity-30 mb-2">Chargement...</span>
    </div>
    <div id="galleryContainer" class="grid grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12"></div>
  </main>

  <!-- PANNEAU ADMIN -->
  <section id="adminPanel" style="display:none;" class="py-24 bg-neutral-100 border-y border-neutral-200">
    <div class="max-w-[500px] mx-auto px-6">
        <div class="flex justify-between items-center mb-10">
            <h2 class="serif text-4xl italic">Gestion Stock</h2>
            <button onclick="logoutAdmin()" class="text-[9px] uppercase font-bold tracking-widest border border-black px-4 py-2">D√©connexion</button>
        </div>
        <form id="adminAddForm" class="bg-white p-8 border border-black">
            <div class="mb-6">
                <label class="block text-[10px] uppercase font-bold tracking-widest mb-2">Photo de l'article</label>
                <input type="file" id="adminImage" accept="image/*" class="w-full text-xs">
            </div>
            <input id="adminName" placeholder="Nom du v√™tement" required class="input-classic">
            <div class="grid grid-cols-2 gap-4">
                <select id="adminCategory" class="input-classic">
                    <option value="homme">Homme</option>
                    <option value="femme">Femme</option>
                </select>
                <input id="adminSize" placeholder="Taille (ex: M)" required class="input-classic">
            </div>
            <input id="adminPrice" type="number" placeholder="Prix (MAD)" required class="input-classic">
            <button type="submit" id="addBtn" class="btn-black">Ajouter au catalogue</button>
        </form>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-black text-white pt-32 pb-16 px-8">
    <div class="max-w-[1400px] mx-auto">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-white/10 pb-20 gap-10">
        <div>
          <p class="serif italic text-6xl mb-4">Khoud-7wayji</p>
          <p class="text-[10px] uppercase tracking-[0.6em] opacity-40">Khoud l-style, flex l-vibe!</p>
        </div>
        <a href="https://www.instagram.com/khoud_7wayji" target="_blank" class="group flex items-center space-x-4 border border-white/20 p-5 hover:bg-white hover:text-black transition-all">
          <i class="fa-brands fa-instagram text-2xl"></i>
          <span class="text-xs font-bold uppercase tracking-widest">Suivre l'aventure</span>
        </a>
      </div>
      <div class="text-right py-10">
        <button onclick="openModal('adminLoginModal')" class="text-[10px] uppercase font-bold tracking-widest opacity-20 hover:opacity-100">Admin</button>
      </div>
    </div>
  </footer>

  <!-- MODALS -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <button onclick="closeModal('cartModal')" class="absolute top-6 right-6 text-xl">&times;</button>
      <h2 class="serif text-4xl mb-8 italic">Mon Panier</h2>
      <div id="cartItemsList" class="max-h-[50vh] overflow-y-auto mb-8"></div>
      <div id="cartEmpty" class="text-center py-10 opacity-30 italic">Votre panier est vide.</div>
      <div id="cartSummary" style="display:none">
        <div class="flex justify-between border-t border-black pt-4 mb-8">
            <span class="font-bold uppercase text-[10px] tracking-widest">Total</span>
            <span id="cartTotal" class="font-bold">0 MAD</span>
        </div>
        <button onclick="closeModal('cartModal'); openModal('checkoutModal')" class="btn-black">Commander</button>
      </div>
    </div>
  </div>

  <div id="checkoutModal" class="modal">
    <div class="modal-content">
      <button onclick="closeModal('checkoutModal')" class="absolute top-6 right-6 text-xl">&times;</button>
      <h2 class="serif text-4xl mb-6 italic">Livraison</h2>
      <form id="checkoutForm">
        <input id="custName" placeholder="Nom Complet" required class="input-classic">
        <input id="custCity" placeholder="Ville" required class="input-classic">
        <input id="custAddress" placeholder="Adresse Exacte" required class="input-classic">
        <button type="submit" class="btn-black">Finaliser sur WhatsApp</button>
      </form>
    </div>
  </div>

  <div id="adminLoginModal" class="modal">
    <div class="modal-content text-center">
      <button onclick="closeModal('adminLoginModal')" class="absolute top-6 right-6 text-xl">&times;</button>
      <h2 class="serif text-4xl mb-8 italic">Acc√®s Admin</h2>
      <form id="adminLoginForm">
        <input type="email" id="adminEmail" placeholder="Email Admin" required class="input-classic">
        <input type="password" id="adminPass" placeholder="Mot de passe" required class="input-classic">
        <button type="submit" class="btn-black">Se connecter</button>
      </form>
    </div>
  </div>

  <div id="alert" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[20000] opacity-0 transition-opacity duration-500 pointer-events-none">
    <div class="bg-black text-white px-8 py-4 text-[10px] font-bold uppercase tracking-widest shadow-2xl">
      <span id="alertMsg"></span>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, doc, addDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- CONFIGURATION FIREBASE ---
    // Si tu es sur GitHub Pages, tu dois remplacer l'objet ci-dessous par tes propres cl√©s Firebase
    // R√©cup√®re-les sur console.firebase.google.com
    let firebaseConfig;
    try {
        firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    } catch(e) {
        firebaseConfig = {};
    }

    // S√©curit√© Loader : S'il n'y a pas de config (cas GitHub sans config inject√©e), on enl√®ve le loader apr√®s 2s
    setTimeout(() => {
        const loader = document.getElementById('loader');
        if (loader && loader.style.display !== 'none') {
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
            console.warn("Firebase non configur√© : Affichage en mode d√©mo.");
        }
    }, 2500);

    // Initialisation uniquement si la config existe
    if (firebaseConfig.apiKey) {
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'khoud-7wayji-external';

        let articles = [];
        let cart = [];
        let isAdmin = false;
        let currentFilter = 'all';

        const ADMIN_CREDS = { email: 'admin@khoud.ma', pass: 'admin123' };
        const WA_NUMBER = "212773515753";

        const setupAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const loader = document.getElementById('loader');
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
                listenToStore(db, appId);
            }
        });

        setupAuth();

        function listenToStore(db, appId) {
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'articles'), (snap) => {
                articles = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                articles.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderGallery(currentFilter);
            });
        }

        // Fonctions Globales
        window.filterGallery = (cat) => {
            currentFilter = cat;
            document.getElementById('galleryTitle').innerText = cat === 'homme' ? "Vestiaire Homme" : (cat === 'femme' ? "Vestiaire Femme" : "Le Vestiaire");
            document.getElementById('market-section').scrollIntoView({ behavior: 'smooth' });
            renderGallery(cat);
        };

        function renderGallery(filter) {
            const container = document.getElementById('galleryContainer');
            const items = filter === 'all' ? articles : articles.filter(a => a.category === filter);
            document.getElementById('itemCount').innerText = `${items.length} PI√àCES`;

            if (items.length === 0) {
                container.innerHTML = `<div class="col-span-full py-20 text-center italic opacity-30">Arrivage en cours...</div>`;
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="group">
                    <div class="aspect-[3/4] bg-neutral-100 mb-6 overflow-hidden relative">
                        <img src="${item.imageUrl}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute bottom-4 left-4 bg-white px-2 py-1 text-[8px] font-bold tracking-widest border border-black">${item.size}</div>
                        ${isAdmin ? 
                            `<button onclick="deleteItem('${item.id}')" class="absolute top-4 right-4 bg-red-600 text-white text-[8px] font-bold px-3 py-1">Supprimer</button>` :
                            `<button onclick="addToCart('${item.id}')" class="absolute top-4 right-4 pill-btn opacity-0 group-hover:opacity-100 transition-opacity">Ajouter</button>`
                        }
                    </div>
                    <div class="flex justify-between items-center">
                        <h4 class="serif text-xl font-bold">${item.name}</h4>
                        <span class="text-[10px] font-bold opacity-40">${item.price} MAD</span>
                    </div>
                </div>
            `).join('');
        }

        window.addToCart = (id) => {
            const item = articles.find(a => a.id === id);
            if (cart.find(c => c.id === id)) return notify("D√©j√† ajout√©");
            cart.push(item);
            updateCartBadge();
            notify("Ajout√© au panier !");
        };

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const icon = document.getElementById('cartIcon');
            badge.innerText = cart.length;
            icon.style.display = cart.length > 0 && !isAdmin ? 'flex' : 'none';
        }

        window.renderCartItems = () => {
            const list = document.getElementById('cartItemsList');
            const summary = document.getElementById('cartSummary');
            const empty = document.getElementById('cartEmpty');
            if (cart.length === 0) {
                list.innerHTML = ""; summary.style.display = "none"; empty.style.display = "block";
                return;
            }
            empty.style.display = "none"; summary.style.display = "block";
            list.innerHTML = cart.map(item => `
                <div class="flex items-center space-x-4 mb-4 pb-4 border-b border-gray-100">
                    <img src="${item.imageUrl}" class="w-16 h-20 object-cover">
                    <div class="flex-1">
                        <p class="serif font-bold">${item.name}</p>
                        <p class="text-[10px] opacity-40 uppercase font-bold tracking-widest">${item.size} ¬∑ ${item.price} MAD</p>
                    </div>
                    <button onclick="removeFromCart('${item.id}')" class="text-xl">&times;</button>
                </div>
            `).join('');
            const total = cart.reduce((acc, i) => acc + parseInt(i.price), 0);
            document.getElementById('cartTotal').innerText = `${total} MAD`;
        };

        window.removeFromCart = (id) => {
            cart = cart.filter(c => c.id !== id);
            updateCartBadge();
            renderCartItems();
        };

        document.getElementById('checkoutForm').onsubmit = (e) => {
            e.preventDefault();
            const total = cart.reduce((acc, i) => acc + parseInt(i.price), 0);
            let msg = `*KHOUD-7WAYJI*%0A*Client:* ${document.getElementById('custName').value}%0A*Ville:* ${document.getElementById('custCity').value}%0A%0A*Articles:*%0A`;
            cart.forEach(i => msg += `- ${i.name} (${i.size}) : ${i.price} MAD%0A`);
            msg += `%0A*TOTAL: ${total} MAD*`;
            window.open(`https://wa.me/${WA_NUMBER}?text=${msg}`, '_blank');
        };

        document.getElementById('adminLoginForm').onsubmit = (e) => {
            e.preventDefault();
            if (document.getElementById('adminEmail').value === ADMIN_CREDS.email && document.getElementById('adminPass').value === ADMIN_CREDS.pass) {
                isAdmin = true;
                closeModal('adminLoginModal');
                document.getElementById('adminPanel').style.display = 'block';
                renderGallery(currentFilter);
            }
        };

        window.logoutAdmin = () => { isAdmin = false; document.getElementById('adminPanel').style.display = 'none'; renderGallery(currentFilter); };

        document.getElementById('adminAddForm').onsubmit = async (e) => {
            e.preventDefault();
            const file = document.getElementById('adminImage').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'articles'), {
                    name: document.getElementById('adminName').value,
                    category: document.getElementById('adminCategory').value,
                    size: document.getElementById('adminSize').value,
                    price: document.getElementById('adminPrice').value,
                    imageUrl: reader.result,
                    createdAt: new Date().toISOString()
                });
                document.getElementById('adminAddForm').reset();
            };
        };

        window.deleteItem = async (id) => {
            if (confirm("Supprimer ?")) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'articles', id));
        };
    }

    // Modal helpers
    window.openModal = (id) => {
        document.getElementById(id).style.display = 'flex';
        if(id === 'cartModal' && window.renderCartItems) renderCartItems();
    };
    window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; };
    window.notify = (msg) => {
        const el = document.getElementById('alert');
        document.getElementById('alertMsg').innerText = msg;
        el.style.opacity = '1';
        setTimeout(() => el.style.opacity = '0', 3000);
    };
    window.onclick = (e) => { if(e.target.classList.contains('modal')) closeModal(e.target.id); };
  </script>
</body>
</html>
